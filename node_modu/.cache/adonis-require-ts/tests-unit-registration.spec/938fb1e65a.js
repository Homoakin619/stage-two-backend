"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const runner_1 = require("@japa/runner");
const sinon_1 = __importDefault(require("sinon"));
const UserRegistrationController_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Controllers/Http/UserRegistrationController"));
const Database_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Lucid/Database"));
const UserAction_1 = global[Symbol.for('ioc.use')]("App/Actions/UserAction");
runner_1.test.group('User Registration Controller', (group) => {
    let dbTransaction;
    let sandbox;
    group.setup(async () => {
        dbTransaction = await Database_1.default.beginGlobalTransaction();
        sandbox = sinon_1.default.createSandbox();
    });
    group.teardown(async () => {
        await Database_1.default.rollbackGlobalTransaction();
        sandbox.restore();
    });
    (0, runner_1.test)('should return 422 if validation fails', async ({ assert }) => {
        const controller = new UserRegistrationController_1.default();
        const request = {
            validate: sandbox.stub().throws({ messages: { errors: ['Validation failed'] } }),
            body: sandbox.stub().returns({})
        };
        const response = {
            status: sandbox.stub().returnsThis(),
            send: sandbox.stub()
        };
        const auth = {};
        const ctx = { request, response, auth };
        await controller.handle(ctx);
        assert.isTrue(response.status.calledWith(422));
        assert.isTrue(response.send.calledWith({ messages: { errors: ['Validation failed'] } }));
    });
    (0, runner_1.test)('should return 500 if an error occurs during registration', async ({ assert }) => {
        const controller = new UserRegistrationController_1.default();
        sandbox.stub(UserAction_1.UserActions, 'createUser').throws(new Error('Simulated error'));
        const request = {
            validate: sandbox.stub().resolves(),
            body: sandbox.stub().returns({
                firstName: 'Jane',
                lastName: 'Doe',
                email: 'jane.doe@example.com',
                password: 'password123',
                phone: '0987654321'
            })
        };
        const response = {
            status: sandbox.stub().returnsThis(),
            send: sandbox.stub()
        };
        const auth = {};
        const ctx = { request, response, auth };
        await controller.handle(ctx);
        assert.isTrue(response.status.calledWith(500));
        assert.isTrue(response.send.calledWith({
            status: 'Error',
            message: 'Error Occured Creating User',
            statusCode: 500
        }));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVnaXN0cmF0aW9uLnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZWdpc3RyYXRpb24uc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLHlDQUFtQztBQUNuQyxrREFBeUI7QUFDekIsdUlBQXdGO0FBRXhGLDJGQUFpRDtBQUNqRCw2RUFBb0Q7QUFPcEQsYUFBSSxDQUFDLEtBQUssQ0FBQyw4QkFBOEIsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQ25ELElBQUksYUFBYSxDQUFBO0lBQ2pCLElBQUksT0FBMkIsQ0FBQTtJQUUvQixLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3JCLGFBQWEsR0FBRyxNQUFNLGtCQUFRLENBQUMsc0JBQXNCLEVBQUUsQ0FBQTtRQUN2RCxPQUFPLEdBQUcsZUFBSyxDQUFDLGFBQWEsRUFBRSxDQUFBO0lBQ2pDLENBQUMsQ0FBQyxDQUFBO0lBRUYsS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUN4QixNQUFNLGtCQUFRLENBQUMseUJBQXlCLEVBQUUsQ0FBQTtRQUMxQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUE7SUFDbkIsQ0FBQyxDQUFDLENBQUE7SUFZRixJQUFBLGFBQUksRUFBQyx1Q0FBdUMsRUFBRSxLQUFLLEVBQUUsRUFBQyxNQUFNLEVBQUMsRUFBRSxFQUFFO1FBQy9ELE1BQU0sVUFBVSxHQUFHLElBQUksb0NBQTBCLEVBQUUsQ0FBQTtRQUVuRCxNQUFNLE9BQU8sR0FBRztZQUNkLFFBQVEsRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsbUJBQW1CLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDaEYsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1NBQ2pDLENBQUE7UUFDRCxNQUFNLFFBQVEsR0FBRztZQUNmLE1BQU0sRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO1lBQ3BDLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFO1NBQ3JCLENBQUE7UUFDRCxNQUFNLElBQUksR0FBRyxFQUFFLENBQUE7UUFFZixNQUFNLEdBQUcsR0FBRyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFvQyxDQUFBO1FBRXpFLE1BQU0sVUFBVSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUU1QixNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7UUFDOUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLG1CQUFtQixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUMxRixDQUFDLENBQUMsQ0FBQTtJQW9ERixJQUFBLGFBQUksRUFBQywwREFBMEQsRUFBRSxLQUFLLEVBQUUsRUFBQyxNQUFNLEVBQUMsRUFBRSxFQUFFO1FBQ2xGLE1BQU0sVUFBVSxHQUFHLElBQUksb0NBQTBCLEVBQUUsQ0FBQTtRQUVuRCxPQUFPLENBQUMsSUFBSSxDQUFDLHdCQUFXLEVBQUUsWUFBWSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQTtRQUU1RSxNQUFNLE9BQU8sR0FBRztZQUNkLFFBQVEsRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsUUFBUSxFQUFFO1lBQ25DLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDO2dCQUMzQixTQUFTLEVBQUUsTUFBTTtnQkFDakIsUUFBUSxFQUFFLEtBQUs7Z0JBQ2YsS0FBSyxFQUFFLHNCQUFzQjtnQkFDN0IsUUFBUSxFQUFFLGFBQWE7Z0JBQ3ZCLEtBQUssRUFBRSxZQUFZO2FBQ3BCLENBQUM7U0FDSCxDQUFBO1FBQ0QsTUFBTSxRQUFRLEdBQUc7WUFDZixNQUFNLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtZQUNwQyxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRTtTQUNyQixDQUFBO1FBQ0QsTUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFBO1FBRWYsTUFBTSxHQUFHLEdBQUcsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBb0MsQ0FBQTtRQUV6RSxNQUFNLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFNUIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO1FBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7WUFDckMsTUFBTSxFQUFFLE9BQU87WUFDZixPQUFPLEVBQUUsNkJBQTZCO1lBQ3RDLFVBQVUsRUFBRSxHQUFHO1NBQ2hCLENBQUMsQ0FBQyxDQUFBO0lBQ0wsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHRlc3QgfSBmcm9tICdAamFwYS9ydW5uZXInXG5pbXBvcnQgc2lub24gZnJvbSBcInNpbm9uXCJcbmltcG9ydCBVc2VyUmVnaXN0cmF0aW9uQ29udHJvbGxlciBmcm9tICdBcHAvQ29udHJvbGxlcnMvSHR0cC9Vc2VyUmVnaXN0cmF0aW9uQ29udHJvbGxlcidcbmltcG9ydCB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xuaW1wb3J0IERhdGFiYXNlIGZyb20gJ0Bpb2M6QWRvbmlzL0x1Y2lkL0RhdGFiYXNlJ1xuaW1wb3J0IHsgVXNlckFjdGlvbnMgfSBmcm9tICdBcHAvQWN0aW9ucy9Vc2VyQWN0aW9uJ1xuaW1wb3J0IHsgT3JnYW5pc2F0aW9uQWN0aW9ucyB9IGZyb20gJ0FwcC9BY3Rpb25zL09yZ2FuaXNhdGlvbkFjdGlvbidcbmltcG9ydCBIYXNoIGZyb20gJ0Bpb2M6QWRvbmlzL0NvcmUvSGFzaCdcbmltcG9ydCBVc2VyIGZyb20gJ0FwcC9Nb2RlbHMvVXNlcidcbmltcG9ydCBPcmdhbmlzYXRpb24gZnJvbSAnQXBwL01vZGVscy9PcmdhbmlzYXRpb24nXG5pbXBvcnQgYXBwQ29uZmlnIGZyb20gJ0NvbmZpZy9hcHBDb25maWcnXG5cbnRlc3QuZ3JvdXAoJ1VzZXIgUmVnaXN0cmF0aW9uIENvbnRyb2xsZXInLCAoZ3JvdXApID0+IHtcbiAgbGV0IGRiVHJhbnNhY3Rpb25cbiAgbGV0IHNhbmRib3g6IHNpbm9uLlNpbm9uU2FuZGJveFxuXG4gIGdyb3VwLnNldHVwKGFzeW5jICgpID0+IHtcbiAgICBkYlRyYW5zYWN0aW9uID0gYXdhaXQgRGF0YWJhc2UuYmVnaW5HbG9iYWxUcmFuc2FjdGlvbigpXG4gICAgc2FuZGJveCA9IHNpbm9uLmNyZWF0ZVNhbmRib3goKVxuICB9KVxuXG4gIGdyb3VwLnRlYXJkb3duKGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBEYXRhYmFzZS5yb2xsYmFja0dsb2JhbFRyYW5zYWN0aW9uKClcbiAgICBzYW5kYm94LnJlc3RvcmUoKVxuICB9KSBcblxuLy8gICBncm91cC5iZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbi8vICAgICBkYlRyYW5zYWN0aW9uID0gYXdhaXQgRGF0YWJhc2UudHJhbnNhY3Rpb24oKVxuLy8gICAgIHNhbmRib3ggPSBzaW5vbi5jcmVhdGVTYW5kYm94KClcbi8vICAgfSlcblxuLy8gICBncm91cC5hZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuLy8gICAgIGF3YWl0IGRiVHJhbnNhY3Rpb24ucm9sbGJhY2soKVxuLy8gICAgIHNhbmRib3gucmVzdG9yZSgpXG4vLyAgIH0pXG5cbiAgdGVzdCgnc2hvdWxkIHJldHVybiA0MjIgaWYgdmFsaWRhdGlvbiBmYWlscycsIGFzeW5jICh7YXNzZXJ0fSkgPT4ge1xuICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgVXNlclJlZ2lzdHJhdGlvbkNvbnRyb2xsZXIoKVxuXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcbiAgICAgIHZhbGlkYXRlOiBzYW5kYm94LnN0dWIoKS50aHJvd3MoeyBtZXNzYWdlczogeyBlcnJvcnM6IFsnVmFsaWRhdGlvbiBmYWlsZWQnXSB9IH0pLFxuICAgICAgYm9keTogc2FuZGJveC5zdHViKCkucmV0dXJucyh7fSlcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSB7XG4gICAgICBzdGF0dXM6IHNhbmRib3guc3R1YigpLnJldHVybnNUaGlzKCksXG4gICAgICBzZW5kOiBzYW5kYm94LnN0dWIoKVxuICAgIH1cbiAgICBjb25zdCBhdXRoID0ge31cblxuICAgIGNvbnN0IGN0eCA9IHsgcmVxdWVzdCwgcmVzcG9uc2UsIGF1dGggfSBhcyB1bmtub3duIGFzIEh0dHBDb250ZXh0Q29udHJhY3RcblxuICAgIGF3YWl0IGNvbnRyb2xsZXIuaGFuZGxlKGN0eClcblxuICAgIGFzc2VydC5pc1RydWUocmVzcG9uc2Uuc3RhdHVzLmNhbGxlZFdpdGgoNDIyKSlcbiAgICBhc3NlcnQuaXNUcnVlKHJlc3BvbnNlLnNlbmQuY2FsbGVkV2l0aCh7IG1lc3NhZ2VzOiB7IGVycm9yczogWydWYWxpZGF0aW9uIGZhaWxlZCddIH0gfSkpXG4gIH0pXG5cbi8vICAgdGVzdCgnc2hvdWxkIHJldHVybiAyMDEgaWYgcmVnaXN0cmF0aW9uIGlzIHN1Y2Nlc3NmdWwnLCBhc3luYyAoe2Fzc2VydH0pID0+IHtcbi8vICAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IFVzZXJSZWdpc3RyYXRpb25Db250cm9sbGVyKClcblxuLy8gICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlcigpXG4vLyAgICAgdXNlci5maWxsKHsgaWQ6IDEsIGVtYWlsOiAnam9obi5kb2VAZXhhbXBsZS5jb20nLCBmaXJzdE5hbWU6ICdKb2huJywgbGFzdE5hbWU6ICdEb2UnIH0pXG4vLyAgICAgc2FuZGJveC5zdHViKFVzZXJBY3Rpb25zLCAnY3JlYXRlVXNlcicpLnJlc29sdmVzKHVzZXIpXG5cbi8vICAgICBjb25zdCBvcmdhbmlzYXRpb24gPSBuZXcgT3JnYW5pc2F0aW9uKClcbi8vICAgICBvcmdhbmlzYXRpb24uZmlsbCh7IGlkOiAxLCBuYW1lOiBcIkpvaG4ncyBPcmdhbmlzYXRpb25cIiB9KVxuLy8gICAgIHNhbmRib3guc3R1YihPcmdhbmlzYXRpb25BY3Rpb25zLCAnZ2V0T3JnYW5pc2F0aW9uUmVjb3JkJykucmVzb2x2ZXMobnVsbClcbi8vICAgICBzYW5kYm94LnN0dWIoT3JnYW5pc2F0aW9uQWN0aW9ucywgJ2NyZWF0ZU9yZ2FuaXNhdGlvbicpLnJlc29sdmVzKG9yZ2FuaXNhdGlvbilcbi8vICAgICBzYW5kYm94LnN0dWIoT3JnYW5pc2F0aW9uQWN0aW9ucywgJ2FkZFVzZXJUb09yZ2FuaXNhdGlvbicpLnJlc29sdmVzKClcblxuLy8gICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4vLyAgICAgICB2YWxpZGF0ZTogc2FuZGJveC5zdHViKCkucmVzb2x2ZXMoKSxcbi8vICAgICAgIGJvZHk6IHNhbmRib3guc3R1YigpLnJldHVybnMoe1xuLy8gICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbi8vICAgICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuLy8gICAgICAgICBlbWFpbDogJ2pvaG4uZG9lQGV4YW1wbGUuY29tJyxcbi8vICAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXG4vLyAgICAgICAgIHBob25lOiAnMTIzNDU2Nzg5MCdcbi8vICAgICAgIH0pXG4vLyAgICAgfVxuLy8gICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuLy8gICAgICAgc3RhdHVzOiBzYW5kYm94LnN0dWIoKS5yZXR1cm5zVGhpcygpLFxuLy8gICAgICAgc2VuZDogc2FuZGJveC5zdHViKClcbi8vICAgICB9XG4vLyAgICAgY29uc3QgYXV0aCA9IHtcbi8vICAgICAgIHVzZTogc2FuZGJveC5zdHViKCkucmV0dXJucyh7XG4vLyAgICAgICAgIGF0dGVtcHQ6IHNhbmRib3guc3R1YigpLnJlc29sdmVzKHtcbi8vICAgICAgICAgICB0b2tlbjogJ2p3dC10b2tlbidcbi8vICAgICAgICAgfSlcbi8vICAgICAgIH0pXG4vLyAgICAgfVxuXG4vLyAgICAgY29uc3QgY3R4ID0geyByZXF1ZXN0LCByZXNwb25zZSwgYXV0aCB9IGFzIHVua25vd24gYXMgSHR0cENvbnRleHRDb250cmFjdFxuXG4vLyAgICAgYXdhaXQgY29udHJvbGxlci5oYW5kbGUoY3R4KVxuXG4vLyAgICAgYXNzZXJ0LmlzVHJ1ZShyZXNwb25zZS5zdGF0dXMuY2FsbGVkV2l0aCgyMDEpKVxuLy8gICAgIGFzc2VydC5pc1RydWUocmVzcG9uc2Uuc2VuZC5jYWxsZWRXaXRoKHtcbi8vICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuLy8gICAgICAgbWVzc2FnZTogJ1JlZ2lzdHJhdGlvbiBzdWNjZXNzZnVsJyxcbi8vICAgICAgIGRhdGE6IHtcbi8vICAgICAgICAgYWNjZXNzVG9rZW46ICdqd3QtdG9rZW4nLFxuLy8gICAgICAgICB1c2VyOiB1c2VyLmZvckNsaWVudCgpXG4vLyAgICAgICB9XG4vLyAgICAgfSkpXG4vLyAgIH0pXG5cbiAgdGVzdCgnc2hvdWxkIHJldHVybiA1MDAgaWYgYW4gZXJyb3Igb2NjdXJzIGR1cmluZyByZWdpc3RyYXRpb24nLCBhc3luYyAoe2Fzc2VydH0pID0+IHtcbiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IFVzZXJSZWdpc3RyYXRpb25Db250cm9sbGVyKClcblxuICAgIHNhbmRib3guc3R1YihVc2VyQWN0aW9ucywgJ2NyZWF0ZVVzZXInKS50aHJvd3MobmV3IEVycm9yKCdTaW11bGF0ZWQgZXJyb3InKSlcblxuICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICB2YWxpZGF0ZTogc2FuZGJveC5zdHViKCkucmVzb2x2ZXMoKSxcbiAgICAgIGJvZHk6IHNhbmRib3guc3R1YigpLnJldHVybnMoe1xuICAgICAgICBmaXJzdE5hbWU6ICdKYW5lJyxcbiAgICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuICAgICAgICBlbWFpbDogJ2phbmUuZG9lQGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXG4gICAgICAgIHBob25lOiAnMDk4NzY1NDMyMSdcbiAgICAgIH0pXG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgc3RhdHVzOiBzYW5kYm94LnN0dWIoKS5yZXR1cm5zVGhpcygpLFxuICAgICAgc2VuZDogc2FuZGJveC5zdHViKClcbiAgICB9XG4gICAgY29uc3QgYXV0aCA9IHt9XG5cbiAgICBjb25zdCBjdHggPSB7IHJlcXVlc3QsIHJlc3BvbnNlLCBhdXRoIH0gYXMgdW5rbm93biBhcyBIdHRwQ29udGV4dENvbnRyYWN0XG5cbiAgICBhd2FpdCBjb250cm9sbGVyLmhhbmRsZShjdHgpXG5cbiAgICBhc3NlcnQuaXNUcnVlKHJlc3BvbnNlLnN0YXR1cy5jYWxsZWRXaXRoKDUwMCkpXG4gICAgYXNzZXJ0LmlzVHJ1ZShyZXNwb25zZS5zZW5kLmNhbGxlZFdpdGgoe1xuICAgICAgc3RhdHVzOiAnRXJyb3InLFxuICAgICAgbWVzc2FnZTogJ0Vycm9yIE9jY3VyZWQgQ3JlYXRpbmcgVXNlcicsXG4gICAgICBzdGF0dXNDb2RlOiA1MDBcbiAgICB9KSlcbiAgfSlcbn0pXG4iXX0=