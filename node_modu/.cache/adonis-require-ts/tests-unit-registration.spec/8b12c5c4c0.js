"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const runner_1 = require("@japa/runner");
const sinon_1 = __importDefault(require("sinon"));
const UserRegistrationController_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Controllers/Http/UserRegistrationController"));
const Database_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Lucid/Database"));
const UserAction_1 = global[Symbol.for('ioc.use')]("App/Actions/UserAction");
runner_1.test.group('User Registration Controller', (group) => {
    let dbTransaction;
    let sandbox;
    group.setup(async () => {
        dbTransaction = await Database_1.default.beginGlobalTransaction();
        sandbox = sinon_1.default.createSandbox();
    });
    group.teardown(async () => {
        await Database_1.default.rollbackGlobalTransaction();
        sandbox.restore();
    });
    (0, runner_1.test)('should return 422 if validation fails', async ({ assert }) => {
        const controller = new UserRegistrationController_1.default();
        const request = {
            validate: sandbox.stub().throws({ messages: { errors: ['Validation failed'] } }),
            body: sandbox.stub().returns({})
        };
        const response = {
            status: sandbox.stub().returnsThis(),
            send: sandbox.stub()
        };
        const auth = {};
        const ctx = { request, response, auth };
        await controller.handle(ctx);
        assert.isTrue(response.status.calledWith(422));
    });
    (0, runner_1.test)('should return 500 if an error occurs during registration', async ({ assert }) => {
        const controller = new UserRegistrationController_1.default();
        sandbox.stub(UserAction_1.UserActions, 'createUser').throws(new Error('Simulated error'));
        const request = {
            validate: sandbox.stub().resolves(),
            body: sandbox.stub().returns({
                firstName: 'Jane',
                lastName: 'Doe',
                email: 'jane.doe@example.com',
                password: 'password123',
                phone: '0987654321'
            })
        };
        const response = {
            status: sandbox.stub().returnsThis(),
            send: sandbox.stub()
        };
        const auth = {};
        const ctx = { request, response, auth };
        await controller.handle(ctx);
        assert.isTrue(response.status.calledWith(500));
        assert.isTrue(response.send.calledWith({
            status: 'Error',
            message: 'Error Occured Creating User',
            statusCode: 500
        }));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVnaXN0cmF0aW9uLnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZWdpc3RyYXRpb24uc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLHlDQUFtQztBQUNuQyxrREFBeUI7QUFDekIsdUlBQXdGO0FBRXhGLDJGQUFpRDtBQUNqRCw2RUFBb0Q7QUFPcEQsYUFBSSxDQUFDLEtBQUssQ0FBQyw4QkFBOEIsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQ25ELElBQUksYUFBYSxDQUFBO0lBQ2pCLElBQUksT0FBMkIsQ0FBQTtJQUUvQixLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3JCLGFBQWEsR0FBRyxNQUFNLGtCQUFRLENBQUMsc0JBQXNCLEVBQUUsQ0FBQTtRQUN2RCxPQUFPLEdBQUcsZUFBSyxDQUFDLGFBQWEsRUFBRSxDQUFBO0lBQ2pDLENBQUMsQ0FBQyxDQUFBO0lBRUYsS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUN4QixNQUFNLGtCQUFRLENBQUMseUJBQXlCLEVBQUUsQ0FBQTtRQUMxQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUE7SUFDbkIsQ0FBQyxDQUFDLENBQUE7SUFZRixJQUFBLGFBQUksRUFBQyx1Q0FBdUMsRUFBRSxLQUFLLEVBQUUsRUFBQyxNQUFNLEVBQUMsRUFBRSxFQUFFO1FBQy9ELE1BQU0sVUFBVSxHQUFHLElBQUksb0NBQTBCLEVBQUUsQ0FBQTtRQUVuRCxNQUFNLE9BQU8sR0FBRztZQUNkLFFBQVEsRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsbUJBQW1CLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDaEYsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1NBQ2pDLENBQUE7UUFDRCxNQUFNLFFBQVEsR0FBRztZQUNmLE1BQU0sRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO1lBQ3BDLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFO1NBQ3JCLENBQUE7UUFDRCxNQUFNLElBQUksR0FBRyxFQUFFLENBQUE7UUFFZixNQUFNLEdBQUcsR0FBRyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFvQyxDQUFBO1FBRXpFLE1BQU0sVUFBVSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUU1QixNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFFaEQsQ0FBQyxDQUFDLENBQUE7SUFvREYsSUFBQSxhQUFJLEVBQUMsMERBQTBELEVBQUUsS0FBSyxFQUFFLEVBQUMsTUFBTSxFQUFDLEVBQUUsRUFBRTtRQUNsRixNQUFNLFVBQVUsR0FBRyxJQUFJLG9DQUEwQixFQUFFLENBQUE7UUFFbkQsT0FBTyxDQUFDLElBQUksQ0FBQyx3QkFBVyxFQUFFLFlBQVksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUE7UUFFNUUsTUFBTSxPQUFPLEdBQUc7WUFDZCxRQUFRLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLFFBQVEsRUFBRTtZQUNuQyxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLE9BQU8sQ0FBQztnQkFDM0IsU0FBUyxFQUFFLE1BQU07Z0JBQ2pCLFFBQVEsRUFBRSxLQUFLO2dCQUNmLEtBQUssRUFBRSxzQkFBc0I7Z0JBQzdCLFFBQVEsRUFBRSxhQUFhO2dCQUN2QixLQUFLLEVBQUUsWUFBWTthQUNwQixDQUFDO1NBQ0gsQ0FBQTtRQUNELE1BQU0sUUFBUSxHQUFHO1lBQ2YsTUFBTSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7WUFDcEMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUU7U0FDckIsQ0FBQTtRQUNELE1BQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQTtRQUVmLE1BQU0sR0FBRyxHQUFHLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQW9DLENBQUE7UUFFekUsTUFBTSxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBRTVCLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUM5QyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1lBQ3JDLE1BQU0sRUFBRSxPQUFPO1lBQ2YsT0FBTyxFQUFFLDZCQUE2QjtZQUN0QyxVQUFVLEVBQUUsR0FBRztTQUNoQixDQUFDLENBQUMsQ0FBQTtJQUNMLENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0ZXN0IH0gZnJvbSAnQGphcGEvcnVubmVyJ1xuaW1wb3J0IHNpbm9uIGZyb20gXCJzaW5vblwiXG5pbXBvcnQgVXNlclJlZ2lzdHJhdGlvbkNvbnRyb2xsZXIgZnJvbSAnQXBwL0NvbnRyb2xsZXJzL0h0dHAvVXNlclJlZ2lzdHJhdGlvbkNvbnRyb2xsZXInXG5pbXBvcnQgeyBIdHRwQ29udGV4dENvbnRyYWN0IH0gZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IdHRwQ29udGV4dCdcbmltcG9ydCBEYXRhYmFzZSBmcm9tICdAaW9jOkFkb25pcy9MdWNpZC9EYXRhYmFzZSdcbmltcG9ydCB7IFVzZXJBY3Rpb25zIH0gZnJvbSAnQXBwL0FjdGlvbnMvVXNlckFjdGlvbidcbmltcG9ydCB7IE9yZ2FuaXNhdGlvbkFjdGlvbnMgfSBmcm9tICdBcHAvQWN0aW9ucy9PcmdhbmlzYXRpb25BY3Rpb24nXG5pbXBvcnQgSGFzaCBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0hhc2gnXG5pbXBvcnQgVXNlciBmcm9tICdBcHAvTW9kZWxzL1VzZXInXG5pbXBvcnQgT3JnYW5pc2F0aW9uIGZyb20gJ0FwcC9Nb2RlbHMvT3JnYW5pc2F0aW9uJ1xuaW1wb3J0IGFwcENvbmZpZyBmcm9tICdDb25maWcvYXBwQ29uZmlnJ1xuXG50ZXN0Lmdyb3VwKCdVc2VyIFJlZ2lzdHJhdGlvbiBDb250cm9sbGVyJywgKGdyb3VwKSA9PiB7XG4gIGxldCBkYlRyYW5zYWN0aW9uXG4gIGxldCBzYW5kYm94OiBzaW5vbi5TaW5vblNhbmRib3hcblxuICBncm91cC5zZXR1cChhc3luYyAoKSA9PiB7XG4gICAgZGJUcmFuc2FjdGlvbiA9IGF3YWl0IERhdGFiYXNlLmJlZ2luR2xvYmFsVHJhbnNhY3Rpb24oKVxuICAgIHNhbmRib3ggPSBzaW5vbi5jcmVhdGVTYW5kYm94KClcbiAgfSlcblxuICBncm91cC50ZWFyZG93bihhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgRGF0YWJhc2Uucm9sbGJhY2tHbG9iYWxUcmFuc2FjdGlvbigpXG4gICAgc2FuZGJveC5yZXN0b3JlKClcbiAgfSkgXG5cbi8vICAgZ3JvdXAuYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4vLyAgICAgZGJUcmFuc2FjdGlvbiA9IGF3YWl0IERhdGFiYXNlLnRyYW5zYWN0aW9uKClcbi8vICAgICBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpXG4vLyAgIH0pXG5cbi8vICAgZ3JvdXAuYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbi8vICAgICBhd2FpdCBkYlRyYW5zYWN0aW9uLnJvbGxiYWNrKClcbi8vICAgICBzYW5kYm94LnJlc3RvcmUoKVxuLy8gICB9KVxuXG4gIHRlc3QoJ3Nob3VsZCByZXR1cm4gNDIyIGlmIHZhbGlkYXRpb24gZmFpbHMnLCBhc3luYyAoe2Fzc2VydH0pID0+IHtcbiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IFVzZXJSZWdpc3RyYXRpb25Db250cm9sbGVyKClcblxuICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICB2YWxpZGF0ZTogc2FuZGJveC5zdHViKCkudGhyb3dzKHsgbWVzc2FnZXM6IHsgZXJyb3JzOiBbJ1ZhbGlkYXRpb24gZmFpbGVkJ10gfSB9KSxcbiAgICAgIGJvZHk6IHNhbmRib3guc3R1YigpLnJldHVybnMoe30pXG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgc3RhdHVzOiBzYW5kYm94LnN0dWIoKS5yZXR1cm5zVGhpcygpLFxuICAgICAgc2VuZDogc2FuZGJveC5zdHViKClcbiAgICB9XG4gICAgY29uc3QgYXV0aCA9IHt9XG5cbiAgICBjb25zdCBjdHggPSB7IHJlcXVlc3QsIHJlc3BvbnNlLCBhdXRoIH0gYXMgdW5rbm93biBhcyBIdHRwQ29udGV4dENvbnRyYWN0XG5cbiAgICBhd2FpdCBjb250cm9sbGVyLmhhbmRsZShjdHgpXG5cbiAgICBhc3NlcnQuaXNUcnVlKHJlc3BvbnNlLnN0YXR1cy5jYWxsZWRXaXRoKDQyMikpXG4gICAgXG4gIH0pXG5cbi8vICAgdGVzdCgnc2hvdWxkIHJldHVybiAyMDEgaWYgcmVnaXN0cmF0aW9uIGlzIHN1Y2Nlc3NmdWwnLCBhc3luYyAoe2Fzc2VydH0pID0+IHtcbi8vICAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IFVzZXJSZWdpc3RyYXRpb25Db250cm9sbGVyKClcblxuLy8gICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlcigpXG4vLyAgICAgdXNlci5maWxsKHsgaWQ6IDEsIGVtYWlsOiAnam9obi5kb2VAZXhhbXBsZS5jb20nLCBmaXJzdE5hbWU6ICdKb2huJywgbGFzdE5hbWU6ICdEb2UnIH0pXG4vLyAgICAgc2FuZGJveC5zdHViKFVzZXJBY3Rpb25zLCAnY3JlYXRlVXNlcicpLnJlc29sdmVzKHVzZXIpXG5cbi8vICAgICBjb25zdCBvcmdhbmlzYXRpb24gPSBuZXcgT3JnYW5pc2F0aW9uKClcbi8vICAgICBvcmdhbmlzYXRpb24uZmlsbCh7IGlkOiAxLCBuYW1lOiBcIkpvaG4ncyBPcmdhbmlzYXRpb25cIiB9KVxuLy8gICAgIHNhbmRib3guc3R1YihPcmdhbmlzYXRpb25BY3Rpb25zLCAnZ2V0T3JnYW5pc2F0aW9uUmVjb3JkJykucmVzb2x2ZXMobnVsbClcbi8vICAgICBzYW5kYm94LnN0dWIoT3JnYW5pc2F0aW9uQWN0aW9ucywgJ2NyZWF0ZU9yZ2FuaXNhdGlvbicpLnJlc29sdmVzKG9yZ2FuaXNhdGlvbilcbi8vICAgICBzYW5kYm94LnN0dWIoT3JnYW5pc2F0aW9uQWN0aW9ucywgJ2FkZFVzZXJUb09yZ2FuaXNhdGlvbicpLnJlc29sdmVzKClcblxuLy8gICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4vLyAgICAgICB2YWxpZGF0ZTogc2FuZGJveC5zdHViKCkucmVzb2x2ZXMoKSxcbi8vICAgICAgIGJvZHk6IHNhbmRib3guc3R1YigpLnJldHVybnMoe1xuLy8gICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbi8vICAgICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuLy8gICAgICAgICBlbWFpbDogJ2pvaG4uZG9lQGV4YW1wbGUuY29tJyxcbi8vICAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXG4vLyAgICAgICAgIHBob25lOiAnMTIzNDU2Nzg5MCdcbi8vICAgICAgIH0pXG4vLyAgICAgfVxuLy8gICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuLy8gICAgICAgc3RhdHVzOiBzYW5kYm94LnN0dWIoKS5yZXR1cm5zVGhpcygpLFxuLy8gICAgICAgc2VuZDogc2FuZGJveC5zdHViKClcbi8vICAgICB9XG4vLyAgICAgY29uc3QgYXV0aCA9IHtcbi8vICAgICAgIHVzZTogc2FuZGJveC5zdHViKCkucmV0dXJucyh7XG4vLyAgICAgICAgIGF0dGVtcHQ6IHNhbmRib3guc3R1YigpLnJlc29sdmVzKHtcbi8vICAgICAgICAgICB0b2tlbjogJ2p3dC10b2tlbidcbi8vICAgICAgICAgfSlcbi8vICAgICAgIH0pXG4vLyAgICAgfVxuXG4vLyAgICAgY29uc3QgY3R4ID0geyByZXF1ZXN0LCByZXNwb25zZSwgYXV0aCB9IGFzIHVua25vd24gYXMgSHR0cENvbnRleHRDb250cmFjdFxuXG4vLyAgICAgYXdhaXQgY29udHJvbGxlci5oYW5kbGUoY3R4KVxuXG4vLyAgICAgYXNzZXJ0LmlzVHJ1ZShyZXNwb25zZS5zdGF0dXMuY2FsbGVkV2l0aCgyMDEpKVxuLy8gICAgIGFzc2VydC5pc1RydWUocmVzcG9uc2Uuc2VuZC5jYWxsZWRXaXRoKHtcbi8vICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuLy8gICAgICAgbWVzc2FnZTogJ1JlZ2lzdHJhdGlvbiBzdWNjZXNzZnVsJyxcbi8vICAgICAgIGRhdGE6IHtcbi8vICAgICAgICAgYWNjZXNzVG9rZW46ICdqd3QtdG9rZW4nLFxuLy8gICAgICAgICB1c2VyOiB1c2VyLmZvckNsaWVudCgpXG4vLyAgICAgICB9XG4vLyAgICAgfSkpXG4vLyAgIH0pXG5cbiAgdGVzdCgnc2hvdWxkIHJldHVybiA1MDAgaWYgYW4gZXJyb3Igb2NjdXJzIGR1cmluZyByZWdpc3RyYXRpb24nLCBhc3luYyAoe2Fzc2VydH0pID0+IHtcbiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IFVzZXJSZWdpc3RyYXRpb25Db250cm9sbGVyKClcblxuICAgIHNhbmRib3guc3R1YihVc2VyQWN0aW9ucywgJ2NyZWF0ZVVzZXInKS50aHJvd3MobmV3IEVycm9yKCdTaW11bGF0ZWQgZXJyb3InKSlcblxuICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICB2YWxpZGF0ZTogc2FuZGJveC5zdHViKCkucmVzb2x2ZXMoKSxcbiAgICAgIGJvZHk6IHNhbmRib3guc3R1YigpLnJldHVybnMoe1xuICAgICAgICBmaXJzdE5hbWU6ICdKYW5lJyxcbiAgICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuICAgICAgICBlbWFpbDogJ2phbmUuZG9lQGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXG4gICAgICAgIHBob25lOiAnMDk4NzY1NDMyMSdcbiAgICAgIH0pXG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgc3RhdHVzOiBzYW5kYm94LnN0dWIoKS5yZXR1cm5zVGhpcygpLFxuICAgICAgc2VuZDogc2FuZGJveC5zdHViKClcbiAgICB9XG4gICAgY29uc3QgYXV0aCA9IHt9XG5cbiAgICBjb25zdCBjdHggPSB7IHJlcXVlc3QsIHJlc3BvbnNlLCBhdXRoIH0gYXMgdW5rbm93biBhcyBIdHRwQ29udGV4dENvbnRyYWN0XG5cbiAgICBhd2FpdCBjb250cm9sbGVyLmhhbmRsZShjdHgpXG5cbiAgICBhc3NlcnQuaXNUcnVlKHJlc3BvbnNlLnN0YXR1cy5jYWxsZWRXaXRoKDUwMCkpXG4gICAgYXNzZXJ0LmlzVHJ1ZShyZXNwb25zZS5zZW5kLmNhbGxlZFdpdGgoe1xuICAgICAgc3RhdHVzOiAnRXJyb3InLFxuICAgICAgbWVzc2FnZTogJ0Vycm9yIE9jY3VyZWQgQ3JlYXRpbmcgVXNlcicsXG4gICAgICBzdGF0dXNDb2RlOiA1MDBcbiAgICB9KSlcbiAgfSlcbn0pXG4iXX0=