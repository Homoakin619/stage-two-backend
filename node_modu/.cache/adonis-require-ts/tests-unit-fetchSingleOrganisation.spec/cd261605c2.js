"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const runner_1 = require("@japa/runner");
const sinon_1 = __importDefault(require("sinon"));
const FetchSingleOrganisationController_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Controllers/Http/FetchSingleOrganisationController"));
const UserAction_1 = global[Symbol.for('ioc.use')]("App/Actions/UserAction");
runner_1.test.group('FetchSingleOrganisationController', (group) => {
    let sandbox;
    group.setup(async () => {
        sandbox = sinon_1.default.createSandbox();
    });
    group.teardown(async () => {
        sandbox.restore();
    });
    group.each.teardown = () => {
        sandbox.restore();
    };
    (0, runner_1.test)('should return 200 and organisation data if organisation is found', async ({ assert }) => {
        const controller = new FetchSingleOrganisationController_1.default();
        const fakeUser = { userId: '123e4567-e89b-12d3-a456-426614174000' };
        const orgId = '123e4567-e89b-12d3-a456-426614174001';
        const fakeOrganisations = [{ orgId: '123e4567-e89b-12d3-a456-426614174001', name: 'Test Org', description: "a random organisation" }];
        sandbox.stub(UserAction_1.UserActions, 'fetchUserOrganisations').resolves(fakeOrganisations);
        const request = {
            param: sandbox.stub().returns(orgId)
        };
        const response = {
            status: sandbox.stub().returnsThis(),
            send: sandbox.stub()
        };
        const auth = {
            user: fakeUser
        };
        const ctx = { request, response, auth };
        await controller.handle(ctx);
        assert.isTrue(response.status.calledWith(200));
        assert.isTrue(response.send.calledWith({
            status: "success",
            message: "Organisation fetched successfully",
            data: fakeOrganisations[0]
        }));
        sandbox.restore();
    });
    (0, runner_1.test)('should return 404 if organisation is not found', async ({ assert }) => {
        const controller = new FetchSingleOrganisationController_1.default();
        const fakeUser = { userId: '123e4567-e89b-12d3-a456-426614174000' };
        const orgId = '123e4567-e89b-12d3-a456-426614174001';
        const fakeOrganisations = [{ orgId: '123e4567-e89b-12d3-a456-426614174002', name: 'Other Org', description: "nice description" }];
        sandbox.stub(UserAction_1.UserActions, 'fetchUserOrganisations').resolves(fakeOrganisations);
        const request = {
            param: sandbox.stub().returns(orgId)
        };
        const response = {
            status: sandbox.stub().returnsThis(),
            send: sandbox.stub()
        };
        const auth = {
            user: fakeUser
        };
        const ctx = { request, response, auth };
        await controller.handle(ctx);
        assert.isTrue(response.status.calledWith(404));
        assert.isTrue(response.send.calledWith({
            status: "Bad Request",
            message: "Organisation record not found",
            data: undefined
        }));
    });
    (0, runner_1.test)('should return 500 if an error occurs', async ({ assert }) => {
        const controller = new FetchSingleOrganisationController_1.default();
        const fakeUser = { userId: '123e4567-e89b-12d3-a456-426614174000' };
        const orgId = '123e4567-e89b-12d3-a456-426614174001';
        sandbox.stub(UserAction_1.UserActions, 'fetchUserOrganisations').throws(new Error('Simulated error'));
        const request = {
            param: sandbox.stub().returns(orgId)
        };
        const response = {
            status: sandbox.stub().returnsThis(),
            send: sandbox.stub()
        };
        const auth = {
            user: fakeUser
        };
        const ctx = { request, response, auth };
        await controller.handle(ctx);
        assert.isTrue(response.status.calledWith(500));
        assert.isTrue(response.send.calledWith({
            status: "Error",
            message: "Error Occured Fetching Organisation",
            statusCode: 500
        }));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmV0Y2hTaW5nbGVPcmdhbmlzYXRpb24uc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZldGNoU2luZ2xlT3JnYW5pc2F0aW9uLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSx5Q0FBaUM7QUFDakMsa0RBQXlCO0FBQ3pCLHFKQUFzRztBQUN0Ryw2RUFBb0Q7QUFJcEQsYUFBSSxDQUFDLEtBQUssQ0FBQyxtQ0FBbUMsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQ3RELElBQUksT0FBMkIsQ0FBQTtJQUVqQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBRXJCLE9BQU8sR0FBRyxlQUFLLENBQUMsYUFBYSxFQUFFLENBQUE7SUFDakMsQ0FBQyxDQUFDLENBQUE7SUFFRixLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3hCLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUNuQixDQUFDLENBQUMsQ0FBQTtJQUVGLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsRUFBRTtRQUN6QixPQUFPLENBQUMsT0FBTyxFQUFFLENBQUE7SUFDbkIsQ0FBQyxDQUFBO0lBR0QsSUFBQSxhQUFJLEVBQUMsa0VBQWtFLEVBQUUsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRTtRQUM1RixNQUFNLFVBQVUsR0FBRyxJQUFJLDJDQUFpQyxFQUFFLENBQUE7UUFFMUQsTUFBTSxRQUFRLEdBQUcsRUFBRSxNQUFNLEVBQUUsc0NBQXNDLEVBQVUsQ0FBQTtRQUMzRSxNQUFNLEtBQUssR0FBRyxzQ0FBc0MsQ0FBQTtRQUNwRCxNQUFNLGlCQUFpQixHQUFHLENBQUMsRUFBRSxLQUFLLEVBQUUsc0NBQXNDLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUMsdUJBQXVCLEVBQUUsQ0FBQyxDQUFBO1FBRXBJLE9BQU8sQ0FBQyxJQUFJLENBQUMsd0JBQVcsRUFB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RCxNQUFNLFFBQVEsR0FBRyxFQUFFLE1BQU0sRUFBRSxzQ0FBc0MsRUFBVSxDQUFBO1FBQzNFLE1BQU0sS0FBSyxHQUFHLHNDQUFzQyxDQUFBO1FBRXBELE9BQU8sQ0FBQyxJQUFJLENBQUMsd0JBQVcsRUFBRSx3QkFBd0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUE7UUFFeEYsTUFBTSxPQUFPLEdBQUc7WUFDZCxLQUFLLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7U0FDckMsQ0FBQTtRQUVELE1BQU0sUUFBUSxHQUFHO1lBQ2YsTUFBTSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7WUFDcEMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUU7U0FDckIsQ0FBQTtRQUVELE1BQU0sSUFBSSxHQUFHO1lBQ1gsSUFBSSxFQUFFLFFBQVE7U0FDZixDQUFBO1FBRUQsTUFBTSxHQUFHLEdBQUcsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBb0MsQ0FBQTtRQUV6RSxNQUFNLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFNUIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO1FBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7WUFDckMsTUFBTSxFQUFFLE9BQU87WUFDZixPQUFPLEVBQUUscUNBQXFDO1lBQzlDLFVBQVUsRUFBRSxHQUFHO1NBQ2hCLENBQUMsQ0FBQyxDQUFBO0lBQ0wsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7dGVzdH0gZnJvbSAnQGphcGEvcnVubmVyJ1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJ1xuaW1wb3J0IEZldGNoU2luZ2xlT3JnYW5pc2F0aW9uQ29udHJvbGxlciBmcm9tICdBcHAvQ29udHJvbGxlcnMvSHR0cC9GZXRjaFNpbmdsZU9yZ2FuaXNhdGlvbkNvbnRyb2xsZXInXG5pbXBvcnQgeyBVc2VyQWN0aW9ucyB9IGZyb20gJ0FwcC9BY3Rpb25zL1VzZXJBY3Rpb24nXG5pbXBvcnQgeyBIdHRwQ29udGV4dENvbnRyYWN0IH0gZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IdHRwQ29udGV4dCdcbmltcG9ydCAgVXNlciAgZnJvbSAnQXBwL01vZGVscy9Vc2VyJ1xuXG50ZXN0Lmdyb3VwKCdGZXRjaFNpbmdsZU9yZ2FuaXNhdGlvbkNvbnRyb2xsZXInLCAoZ3JvdXApID0+IHtcbiAgICBsZXQgc2FuZGJveDogc2lub24uU2lub25TYW5kYm94XG5cbiAgZ3JvdXAuc2V0dXAoYXN5bmMgKCkgPT4ge1xuICAgIFxuICAgIHNhbmRib3ggPSBzaW5vbi5jcmVhdGVTYW5kYm94KClcbiAgfSlcblxuICBncm91cC50ZWFyZG93bihhc3luYyAoKSA9PiB7XG4gICAgc2FuZGJveC5yZXN0b3JlKClcbiAgfSkgXG5cbiAgZ3JvdXAuZWFjaC50ZWFyZG93biA9ICgpID0+IHtcbiAgICBzYW5kYm94LnJlc3RvcmUoKVxuICB9XG5cblxuICB0ZXN0KCdzaG91bGQgcmV0dXJuIDIwMCBhbmQgb3JnYW5pc2F0aW9uIGRhdGEgaWYgb3JnYW5pc2F0aW9uIGlzIGZvdW5kJywgYXN5bmMgKHsgYXNzZXJ0IH0pID0+IHtcbiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEZldGNoU2luZ2xlT3JnYW5pc2F0aW9uQ29udHJvbGxlcigpXG5cbiAgICBjb25zdCBmYWtlVXNlciA9IHsgdXNlcklkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyB9IGFzIFVzZXJcbiAgICBjb25zdCBvcmdJZCA9ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDEnXG4gICAgY29uc3QgZmFrZU9yZ2FuaXNhdGlvbnMgPSBbeyBvcmdJZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMScsIG5hbWU6ICdUZXN0IE9yZycsIGRlc2NyaXB0aW9uOlwiYSByYW5kb20gb3JnYW5pc2F0aW9uXCIgfV1cblxuICAgIHNhbmRib3guc3R1YihVc2VyQWN0aW9ucywgJ2ZldGNoVXNlck9yZ2FuaXNhdGlvbnMnKS5yZXNvbHZlcyhmYWtlT3JnYW5pc2F0aW9ucylcblxuICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICBwYXJhbTogc2FuZGJveC5zdHViKCkucmV0dXJucyhvcmdJZClcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZSA9IHtcbiAgICAgIHN0YXR1czogc2FuZGJveC5zdHViKCkucmV0dXJuc1RoaXMoKSxcbiAgICAgIHNlbmQ6IHNhbmRib3guc3R1YigpXG4gICAgfVxuXG4gICAgY29uc3QgYXV0aCA9IHtcbiAgICAgIHVzZXI6IGZha2VVc2VyXG4gICAgfVxuXG4gICAgY29uc3QgY3R4ID0geyByZXF1ZXN0LCByZXNwb25zZSwgYXV0aCB9IGFzIHVua25vd24gYXMgSHR0cENvbnRleHRDb250cmFjdFxuXG4gICAgYXdhaXQgY29udHJvbGxlci5oYW5kbGUoY3R4KVxuXG4gICAgYXNzZXJ0LmlzVHJ1ZShyZXNwb25zZS5zdGF0dXMuY2FsbGVkV2l0aCgyMDApKVxuICAgIGFzc2VydC5pc1RydWUocmVzcG9uc2Uuc2VuZC5jYWxsZWRXaXRoKHtcbiAgICAgIHN0YXR1czogXCJzdWNjZXNzXCIsXG4gICAgICBtZXNzYWdlOiBcIk9yZ2FuaXNhdGlvbiBmZXRjaGVkIHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgZGF0YTogZmFrZU9yZ2FuaXNhdGlvbnNbMF1cbiAgICB9KSlcbiAgICBzYW5kYm94LnJlc3RvcmUoKVxuICB9KVxuXG4gIHRlc3QoJ3Nob3VsZCByZXR1cm4gNDA0IGlmIG9yZ2FuaXNhdGlvbiBpcyBub3QgZm91bmQnLCBhc3luYyAoeyBhc3NlcnQgfSkgPT4ge1xuICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgRmV0Y2hTaW5nbGVPcmdhbmlzYXRpb25Db250cm9sbGVyKClcblxuICAgIGNvbnN0IGZha2VVc2VyID0geyB1c2VySWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnIH0gYXMgVXNlclxuICAgIGNvbnN0IG9yZ0lkID0gJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMSdcbiAgICBjb25zdCBmYWtlT3JnYW5pc2F0aW9ucyA9IFt7IG9yZ0lkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAyJywgbmFtZTogJ090aGVyIE9yZycsIGRlc2NyaXB0aW9uOiBcIm5pY2UgZGVzY3JpcHRpb25cIiB9XVxuXG4gICAgc2FuZGJveC5zdHViKFVzZXJBY3Rpb25zLCAnZmV0Y2hVc2VyT3JnYW5pc2F0aW9ucycpLnJlc29sdmVzKGZha2VPcmdhbmlzYXRpb25zKVxuXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcbiAgICAgIHBhcmFtOiBzYW5kYm94LnN0dWIoKS5yZXR1cm5zKG9yZ0lkKVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgc3RhdHVzOiBzYW5kYm94LnN0dWIoKS5yZXR1cm5zVGhpcygpLFxuICAgICAgc2VuZDogc2FuZGJveC5zdHViKClcbiAgICB9XG5cbiAgICBjb25zdCBhdXRoID0ge1xuICAgICAgdXNlcjogZmFrZVVzZXJcbiAgICB9XG5cbiAgICBjb25zdCBjdHggPSB7IHJlcXVlc3QsIHJlc3BvbnNlLCBhdXRoIH0gYXMgdW5rbm93biBhcyBIdHRwQ29udGV4dENvbnRyYWN0XG5cbiAgICBhd2FpdCBjb250cm9sbGVyLmhhbmRsZShjdHgpXG5cbiAgICBhc3NlcnQuaXNUcnVlKHJlc3BvbnNlLnN0YXR1cy5jYWxsZWRXaXRoKDQwNCkpXG4gICAgYXNzZXJ0LmlzVHJ1ZShyZXNwb25zZS5zZW5kLmNhbGxlZFdpdGgoe1xuICAgICAgc3RhdHVzOiBcIkJhZCBSZXF1ZXN0XCIsXG4gICAgICBtZXNzYWdlOiBcIk9yZ2FuaXNhdGlvbiByZWNvcmQgbm90IGZvdW5kXCIsXG4gICAgICBkYXRhOiB1bmRlZmluZWRcbiAgICB9KSlcbiAgfSlcblxuICB0ZXN0KCdzaG91bGQgcmV0dXJuIDUwMCBpZiBhbiBlcnJvciBvY2N1cnMnLCBhc3luYyAoeyBhc3NlcnQgfSkgPT4ge1xuICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgRmV0Y2hTaW5nbGVPcmdhbmlzYXRpb25Db250cm9sbGVyKClcblxuICAgIGNvbnN0IGZha2VVc2VyID0geyB1c2VySWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnIH0gYXMgVXNlclxuICAgIGNvbnN0IG9yZ0lkID0gJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMSdcblxuICAgIHNhbmRib3guc3R1YihVc2VyQWN0aW9ucywgJ2ZldGNoVXNlck9yZ2FuaXNhdGlvbnMnKS50aHJvd3MobmV3IEVycm9yKCdTaW11bGF0ZWQgZXJyb3InKSlcblxuICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICBwYXJhbTogc2FuZGJveC5zdHViKCkucmV0dXJucyhvcmdJZClcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZSA9IHtcbiAgICAgIHN0YXR1czogc2FuZGJveC5zdHViKCkucmV0dXJuc1RoaXMoKSxcbiAgICAgIHNlbmQ6IHNhbmRib3guc3R1YigpXG4gICAgfVxuXG4gICAgY29uc3QgYXV0aCA9IHtcbiAgICAgIHVzZXI6IGZha2VVc2VyXG4gICAgfVxuXG4gICAgY29uc3QgY3R4ID0geyByZXF1ZXN0LCByZXNwb25zZSwgYXV0aCB9IGFzIHVua25vd24gYXMgSHR0cENvbnRleHRDb250cmFjdFxuXG4gICAgYXdhaXQgY29udHJvbGxlci5oYW5kbGUoY3R4KVxuXG4gICAgYXNzZXJ0LmlzVHJ1ZShyZXNwb25zZS5zdGF0dXMuY2FsbGVkV2l0aCg1MDApKVxuICAgIGFzc2VydC5pc1RydWUocmVzcG9uc2Uuc2VuZC5jYWxsZWRXaXRoKHtcbiAgICAgIHN0YXR1czogXCJFcnJvclwiLFxuICAgICAgbWVzc2FnZTogXCJFcnJvciBPY2N1cmVkIEZldGNoaW5nIE9yZ2FuaXNhdGlvblwiLFxuICAgICAgc3RhdHVzQ29kZTogNTAwXG4gICAgfSkpXG4gIH0pXG59KVxuIl19